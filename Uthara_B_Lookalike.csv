Task 2: Lookalike Model

merged = transactions.merge(customers, on="CustomerID").merge(products, on="ProductID")
customer_features = merged.groupby("CustomerID").agg({
    "TotalValue": "sum",
    "Quantity": "sum",
    "Price": "mean",
    "Region": "first"
}).reset_index()

customer_features = pd.get_dummies(customer_features, columns=["Region"], drop_first=True)

scaler = StandardScaler()
scaled_features = scaler.fit_transform(customer_features.drop(columns=["CustomerID"]))

similarity_matrix = cosine_similarity(scaled_features)
similarity_df = pd.DataFrame(similarity_matrix, index=customer_features["CustomerID"], columns=customer_features["CustomerID"])

lookalikes = {}
for cust_id in customer_features["CustomerID"][:20]:
    similar_customers = similarity_df.loc[cust_id].sort_values(ascending=False)[1:4]
    lookalikes[cust_id] = list(similar_customers.index), list(similar_customers.values)

# Save to CSV
lookalike_df = pd.DataFrame.from_dict(lookalikes, orient="index", columns=["LookalikeIDs", "Scores"])
lookalike_df.to_csv("Uthara_B_Lookalike.csv", index=True)